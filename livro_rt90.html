<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Livro RT 90 - ROTAM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #000;
      padding: 25px;
    }

    .top-bar {
      display: flex;
      justify-content: flex-start;
      margin-bottom: 15px;
    }

    .btn-voltar {
      background: #2c2c2c;
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 5px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: background 0.3s;
    }

    .btn-voltar:hover {
      background: #444;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header img {
      width: 100px;
      display: block;
      margin: 0 auto 10px;
    }

    .header p {
      margin: 4px 0;
      line-height: 1.3;
    }

    h2 {
      text-align: center;
      color: #000;
      text-decoration: underline;
    }

    form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      margin-top: 20px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }

    textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
      font-size: 14px;
    }

    .footer {
      margin-top: 25px;
      text-align: center;
      font-style: italic;
      color: #444;
    }

    button {
      margin-top: 20px;
      background: #198754;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 15px;
      transition: background 0.3s;
    }

    button:hover {
      background: #157347;
    }

    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      .header img {
        width: 80px;
      }

      form {
        padding: 15px;
      }
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <button class="btn-voltar" onclick="voltarPainel()">‚¨Ö Voltar ao Painel</button>
  </div>

  <div class="header">
    <img src="logo-rotam.png" alt="Logo ROTAM">
    <p><strong>POL√çCIA MILITAR DO ESTADO DE MATO GROSSO</strong></p>
    <p>COMANDO DE POLICIAMENTO ESPECIALIZADO</p>
    <p><strong>BATALH√ÉO ROTAM</strong></p>
    <p><u>RELAT√ìRIO DE SERVI√áO DO DIA: <span id="dataAtual"></span></u></p>
  </div>

  <h2>LIVRO RT 90</h2>

  <form id="livroForm">
    <label>1Ô∏è‚É£ ROTAM Comando e ROTAM 90:</label>
    <textarea rows="3" id="rotamComando"></textarea>

    <label>2Ô∏è‚É£ Altera√ß√µes na Escala de Servi√ßo:</label>
    <textarea rows="3" id="alteracoesEscala"></textarea>

    <label>3Ô∏è‚É£ Distribui√ß√£o das Equipes:</label>
    <textarea rows="3" id="distribuicaoEquipes"></textarea>

    <label>4Ô∏è‚É£ Ocorr√™ncias Registradas:</label>
    <textarea rows="3" id="ocorrencias"></textarea>

    <label>5Ô∏è‚É£ Justi√ßa e Disciplina:</label>
    <textarea rows="3" id="justicaDisciplina"></textarea>

    <label>6Ô∏è‚É£ Documentos:</label>
    <textarea rows="3" id="documentos"></textarea>

    <label>7Ô∏è‚É£ Diversos:</label>
    <textarea rows="3" id="diversos"></textarea>

    <div class="footer">
      Quartel do Batalh√£o ROTAM ‚Äî Cuiab√°/MT<br>
      Data: <span id="dataRodape"></span>
    </div>

    <button type="button" onclick="gerarPDF()">üìÑ Gerar PDF Oficial</button>
  </form>

  <script>
    // === Preenche a data ===
    const data = new Date();
    const opcoes = { day: '2-digit', month: '2-digit', year: 'numeric' };
    const dataFormatada = data.toLocaleDateString('pt-BR', opcoes);
    document.getElementById("dataAtual").innerText = dataFormatada;
    document.getElementById("dataRodape").innerText = dataFormatada;

    // === Voltar ao painel ===
    function voltarPainel() {
      window.location.href = "index.html";
    }

    // === N√∫mero autom√°tico do relat√≥rio ===
    function obterNumeroRelatorio() {
      let numero = localStorage.getItem("rotam_num_relatorio");
      if (!numero) numero = 1;
      const numAtual = parseInt(numero);
      localStorage.setItem("rotam_num_relatorio", numAtual + 1);
      return numAtual.toString().padStart(3, "0");
    }

    // === Gera√ß√£o do PDF ===
    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: "portrait", unit: "mm", format: "a4" });

      const margemEsq = 15;
      let y = 25;

      // Obter n√∫mero sequencial
      const numeroRelatorio = obterNumeroRelatorio();
      const anoAtual = new Date().getFullYear();

      // Adiciona o bras√£o no topo esquerdo
      const img = new Image();
      img.src = "logo-rotam.png";
      await img.decode();
      doc.addImage(img, "PNG", margemEsq, y - 10, 25, 25);

      // Marca d'√°gua central
      const marca = new Image();
      marca.src = "logo-rotam.png";
      await marca.decode();
      doc.addImage(marca, "PNG", 50, 90, 110, 110, "", "FAST", 0.15);

      // Cabe√ßalho
      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text("POL√çCIA MILITAR DO ESTADO DE MATO GROSSO", 105, y, { align: "center" });
      y += 6;
      doc.setFont("helvetica", "normal");
      doc.text("Comando de Policiamento Especializado", 105, y, { align: "center" });
      y += 6;
      doc.setFont("helvetica", "bold");
      doc.text("BATALH√ÉO ROTAM", 105, y, { align: "center" });
      y += 10;

      doc.setFontSize(11);
      doc.text(`RELAT√ìRIO N¬∫ ${numeroRelatorio}/${anoAtual} - RT90`, 105, y, { align: "center" });
      y += 6;
      doc.text(`SERVI√áO DO DIA: ${dataFormatada}`, 105, y, { align: "center" });
      y += 10;

      doc.line(margemEsq, y, 195, y);
      y += 10;

      // Campos principais
      const campos = [
        ["1Ô∏è‚É£ ROTAM Comando e ROTAM 90:", document.getElementById("rotamComando").value],
        ["2Ô∏è‚É£ Altera√ß√µes na Escala de Servi√ßo:", document.getElementById("alteracoesEscala").value],
        ["3Ô∏è‚É£ Distribui√ß√£o das Equipes:", document.getElementById("distribuicaoEquipes").value],
        ["4Ô∏è‚É£ Ocorr√™ncias Registradas:", document.getElementById("ocorrencias").value],
        ["5Ô∏è‚É£ Justi√ßa e Disciplina:", document.getElementById("justicaDisciplina").value],
        ["6Ô∏è‚É£ Documentos:", document.getElementById("documentos").value],
        ["7Ô∏è‚É£ Diversos:", document.getElementById("diversos").value]
      ];

      campos.forEach(([titulo, texto]) => {
        doc.setFont("helvetica", "bold");
        doc.text(titulo, margemEsq, y);
        y += 6;
        doc.setFont("helvetica", "normal");
        const linhas = doc.splitTextToSize(texto || "‚Äî", 180);
        doc.text(linhas, margemEsq, y);
        y += linhas.length * 6 + 6;
      });

      // Linha e rodap√©
      doc.line(margemEsq, 275, 195, 275);
      doc.setFont("helvetica", "italic");
      doc.setFontSize(10);
      doc.text("Quartel do Batalh√£o ROTAM ‚Äî Cuiab√°/MT", 105, 282, { align: "center" });
      doc.text(`Data: ${dataFormatada}`, 105, 288, { align: "center" });

      doc.save(`Livro_RT90_Relatorio_${numeroRelatorio}_${anoAtual}.pdf`);
    }
  </script>
</body>
</html>
